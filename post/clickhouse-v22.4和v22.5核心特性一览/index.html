<!doctype html><html lang=zh-cn><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge,chrome=1"><title>clickhosue v22.4和v22.5核心特性一栏 - 后端技术小屋</title><meta name=renderer content="webkit"><meta name=viewport content="width=device-width,initial-scale=1,maximum-scale=1"><meta http-equiv=cache-control content="no-transform"><meta http-equiv=cache-control content="no-siteapp"><meta name=theme-color content="#f8f5ec"><meta name=msapplication-navbutton-color content="#f8f5ec"><meta name=apple-mobile-web-app-capable content="yes"><meta name=apple-mobile-web-app-status-bar-style content="#f8f5ec"><meta name=author content="后端侠"><meta name=description content="原文 https://clickhouse.com/blog/clickhouse-newsletter-june-2022-materialized-but-still-real-time/ https://clickhouse.com/blog/clickhouse-newsletter-may-2022-explain-statement-query-optimization/ v22.4 事务 事务作为实验特性已经可用。BEGIN TRANSACTION, COMMIT, ROLLBACK语句支持原子地插入多张表或物化视图，以及从某个快照进行满足一致性和隔离"><meta name=keywords content="Hugo,theme,后端侠"><meta name=generator content="Hugo 0.62.2 with theme even"><link rel=canonical href=https://backendhouse.github.io/post/clickhouse-v22.4%E5%92%8Cv22.5%E6%A0%B8%E5%BF%83%E7%89%B9%E6%80%A7%E4%B8%80%E8%A7%88/><link rel=apple-touch-icon sizes=180x180 href=/apple-touch-icon.png><link rel=icon type=image/png sizes=32x32 href=/favicon-32x32.png><link rel=icon type=image/png sizes=16x16 href=/favicon-16x16.png><link rel=manifest href=/manifest.json><link rel=mask-icon href=/safari-pinned-tab.svg color=#5bbad5><link href=/sass/main.min.a2095472a2a8d7ddda1334cf60051cbe40ed55f2467554bb6aa4c17c9bcd27a4.css rel=stylesheet><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@3.1.20/dist/jquery.fancybox.min.css integrity="sha256-7TyXnr2YU040zfSP+rEcz29ggW4j56/ujTPwjMzyqFY=" crossorigin=anonymous><meta property="og:title" content="clickhosue v22.4和v22.5核心特性一栏"><meta property="og:description" content="原文 https://clickhouse.com/blog/clickhouse-newsletter-june-2022-materialized-but-still-real-time/ https://clickhouse.com/blog/clickhouse-newsletter-may-2022-explain-statement-query-optimization/ v22.4 事务 事务作为实验特性已经可用。BEGIN TRANSACTION, COMMIT, ROLLBACK语句支持原子地插入多张表或物化视图，以及从某个快照进行满足一致性和隔离"><meta property="og:type" content="article"><meta property="og:url" content="https://backendhouse.github.io/post/clickhouse-v22.4%E5%92%8Cv22.5%E6%A0%B8%E5%BF%83%E7%89%B9%E6%80%A7%E4%B8%80%E8%A7%88/"><meta property="article:published_time" content="2022-06-27T10:51:24+08:00"><meta property="article:modified_time" content="2022-06-27T10:51:24+08:00"><meta itemprop=name content="clickhosue v22.4和v22.5核心特性一栏"><meta itemprop=description content="原文 https://clickhouse.com/blog/clickhouse-newsletter-june-2022-materialized-but-still-real-time/ https://clickhouse.com/blog/clickhouse-newsletter-may-2022-explain-statement-query-optimization/ v22.4 事务 事务作为实验特性已经可用。BEGIN TRANSACTION, COMMIT, ROLLBACK语句支持原子地插入多张表或物化视图，以及从某个快照进行满足一致性和隔离"><meta itemprop=datePublished content="2022-06-27T10:51:24+08:00"><meta itemprop=dateModified content="2022-06-27T10:51:24+08:00"><meta itemprop=wordCount content="1154"><meta itemprop=keywords content="clickhouse,"><meta name=twitter:card content="summary"><meta name=twitter:title content="clickhosue v22.4和v22.5核心特性一栏"><meta name=twitter:description content="原文 https://clickhouse.com/blog/clickhouse-newsletter-june-2022-materialized-but-still-real-time/ https://clickhouse.com/blog/clickhouse-newsletter-may-2022-explain-statement-query-optimization/ v22.4 事务 事务作为实验特性已经可用。BEGIN TRANSACTION, COMMIT, ROLLBACK语句支持原子地插入多张表或物化视图，以及从某个快照进行满足一致性和隔离"><!--[if lte IE 9]><script src=https://cdnjs.cloudflare.com/ajax/libs/classlist/1.1.20170427/classList.min.js></script><![endif]--><!--[if lt IE 9]><script src=https://cdn.jsdelivr.net/npm/html5shiv@3.7.3/dist/html5shiv.min.js></script><script src=https://cdn.jsdelivr.net/npm/respond.js@1.4.2/dest/respond.min.js></script><![endif]--></head><body><div id=mobile-navbar class=mobile-navbar><div class=mobile-header-logo><a href=/ class=logo>后端技术小屋</a></div><div class=mobile-navbar-icon><span></span><span></span><span></span></div></div><nav id=mobile-menu class="mobile-menu slideout-menu"><ul class=mobile-menu-list><a href=/><li class=mobile-menu-item>Home</li></a><a href=/post/><li class=mobile-menu-item>Archives</li></a><a href=/tags/><li class=mobile-menu-item>Tags</li></a><a href=/categories/><li class=mobile-menu-item>Categories</li></a><a href=/about/><li class=mobile-menu-item>About</li></a></ul></nav><div class=container id=mobile-panel><header id=header class=header><div class=logo-wrapper><a href=/ class=logo>后端技术小屋</a></div><nav class=site-navbar><ul id=menu class=menu><li class=menu-item><a class=menu-item-link href=/>Home</a></li><li class=menu-item><a class=menu-item-link href=/post/>Archives</a></li><li class=menu-item><a class=menu-item-link href=/tags/>Tags</a></li><li class=menu-item><a class=menu-item-link href=/categories/>Categories</a></li><li class=menu-item><a class=menu-item-link href=/about/>About</a></li></ul></nav></header><main id=main class=main><div class=content-wrapper><div id=content class=content><article class=post><header class=post-header><h1 class=post-title>clickhosue v22.4和v22.5核心特性一栏</h1><div class=post-meta><span class=post-time>2022-06-27</span><div class=post-category><a href=/categories/clickhouse/>clickhouse</a></div></div></header><div class=post-toc id=post-toc><h2 class=post-toc-title>文章目录</h2><div class="post-toc-content always-active"><nav id=TableOfContents><ul><li><ul><li><a href=#v224>v22.4</a><ul><li><a href=#事务>事务</a></li><li><a href=#keeper负载均衡>Keeper负载均衡</a></li><li><a href=#mergetree表启动加速>MergeTree表启动加速</a></li><li><a href=#更多的kafka指标>更多的kafka指标</a></li><li><a href=#gap-filling>Gap filling</a></li><li><a href=#一个月的最后一天>一个月的最后一天</a></li><li><a href=#h3>H3</a></li></ul></li><li><a href=#v225>v22.5</a><ul><li><a href=#memory-overcommit>Memory Overcommit</a></li><li><a href=#并行hash-join>并行Hash Join</a></li><li><a href=#grouping-sets>Grouping Sets</a></li><li><a href=#fips>FIPS</a></li></ul></li></ul></li></ul></nav></div></div><div class=post-content><blockquote><p>原文</p><ul><li><a href=https://clickhouse.com/blog/clickhouse-newsletter-june-2022-materialized-but-still-real-time/>https://clickhouse.com/blog/clickhouse-newsletter-june-2022-materialized-but-still-real-time/</a></li><li><a href=https://clickhouse.com/blog/clickhouse-newsletter-may-2022-explain-statement-query-optimization/>https://clickhouse.com/blog/clickhouse-newsletter-may-2022-explain-statement-query-optimization/</a></li></ul></blockquote><h2 id=v224>v22.4</h2><h3 id=事务>事务</h3><p>事务作为实验特性已经可用。BEGIN TRANSACTION, COMMIT, ROLLBACK语句支持原子地插入多张表或物化视图，以及从某个快照进行满足一致性和隔离性的读取。更多精彩敬请期待！</p><h3 id=keeper负载均衡>Keeper负载均衡</h3><p>新的config.xml配置中，&lt;zookeeper_load_balancing>可选择random(default), in_order, nearest_hostname, first_or_random, round_robin等负载均衡方式。当你有分布在不同地域的keeper实例时，该特性可减少CH和keeper之间的延迟</p><h3 id=mergetree表启动加速>MergeTree表启动加速</h3><p>使用use_metadata_cache可配置元数据缓存于内嵌的RocksDB存储引擎中。当CH启动时，它会尽量从缓存中获取元数据，否则退化到从磁盘文件获取。当你的CH实例中包含很多MergeTree parts时(一般由库、表或分区过多，或频繁insert导致)，该特性将非常有用。在极端情况下(700k个parts), 它能使CH启动时间从75分钟缩短到20秒</p><h3 id=更多的kafka指标>更多的kafka指标</h3><p>现在Kafka表引擎暴露了更多的服务指标，例如：已处理的消息条数，错误数，无法解析的消息条数。你可以从系统表system.metrics和system.events中查到这些指标的值</p><h3 id=gap-filling>Gap filling</h3><p>现在可以通过插值来填补查询结果中的gap。例如：当表中包含了以分钟为粒度的数据，但有时候某些分钟的数据是确实的，你可以在查询时加上ORDER BY toStartOfMinute(timestamp) WITH FILL INTERPOLATE (c AS c)使得缺失点的值与之前的相邻点保持一致。根据需要表达式还可以更复杂。</p><h3 id=一个月的最后一天>一个月的最后一天</h3><p>之前CH日期函数只能取整到指定时间段的开始。但是现在你可用toLastDayOfMonth来取整到一个月的最后一天(在金融和会计领域有用)</p><h3 id=h3>H3</h3><p>我们完善了对H3的支持，H3是Uber最初开发并开源的六边形分层地理空间索引系统。如果你还不了解它，查看网站(<a href=https://h3geo.org/>https://h3geo.org/</a>)以及H3与S2 和 Geohash等其他系统间的差异。</p><h2 id=v225>v22.5</h2><h3 id=memory-overcommit>Memory Overcommit</h3><p>在22.2中，我们提出了这个实验特性。它包含一个硬限制和软限制，允许查询在可能的情况下超过软限制，这使得不同类型的查询能够更容易地在CH上执行。在22.5中，memory overcommit默认开启，老的配置max_memory_usage已经从默认配置中移除。</p><h3 id=并行hash-join>并行Hash Join</h3><p>这种新的Join实现将Join切分成多个block然后并行执行。这对大数据量的Join尤其有用，高并行度下可减少80%的执行时长。你可通过设置join_algorithm = &lsquo;parallel_hash&rsquo; 来尝试该特性</p><h3 id=grouping-sets>Grouping Sets</h3><p>GROUP BY增加了新的修饰符GROUPING SETS。 它允许基于任何列的组合执行聚合。顺便问一下，你是否了解修饰符WITH TOTALS、WITH ROLLUP 和 WITH CUBE？</p><h3 id=fips>FIPS</h3><p>我们切换到更新的 BoringSSL 模块，ClickHouse 现在符合 FIPS 标准！</p></div><div class=post-copyright><p class=copyright-item><span class=item-title>文章作者</span>
<span class=item-content>后端侠</span></p><p class=copyright-item><span class=item-title>上次更新</span>
<span class=item-content>2022-06-27</span></p></div><footer class=post-footer><div class=post-tags><a href=/tags/clickhouse/>clickhouse</a></div><nav class=post-nav><a class=prev href=/post/%E8%AF%91clickhouse-22.6%E5%92%8C22.7%E6%96%B0%E7%89%B9%E6%80%A7%E7%9B%98%E7%82%B9/><i class="iconfont icon-left"></i><span class="prev-text nav-default">ClickHouse 22.6-22.7 新特性盘点</span>
<span class="prev-text nav-mobile">上一篇</span></a>
<a class=next href=/post/clickhouse%E4%B8%8E%E7%81%AB%E7%84%B0%E5%9B%BE/><span class="next-text nav-default">clickhouse与火焰图</span>
<span class="next-text nav-mobile">下一篇</span>
<i class="iconfont icon-right"></i></a></nav></footer></article></div><script src=https://utteranc.es/client.js repo=BackendHouse/hugo-comment issue-term=pathname theme=github-light crossorigin=anonymous async></script><noscript>Please enable JavaScript to view the <a href=https://github.com/utterance>comments powered by utterances.</a></noscript></div></main><footer id=footer class=footer><div class=social-links><a href=http://github.com/%e5%90%8e%e7%ab%af%e4%be%a0 class="iconfont icon-github" title=github></a><a href=https://backendhouse.github.io/index.xml type=application/rss+xml class="iconfont icon-rss" title=rss></a></div><div class=copyright><span class=power-by>由 <a class=hexo-link href=https://gohugo.io>Hugo</a> 强力驱动</span>
<span class=division>|</span>
<span class=theme-info>主题 -
<a class=theme-link href=https://github.com/olOwOlo/hugo-theme-even>Even</a></span>
<span class=copyright-year>&copy;
2020 -
2022<span class=heart><i class="iconfont icon-heart"></i></span><span>后端侠</span></span></div></footer><div class=back-to-top id=back-to-top><i class="iconfont icon-up"></i></div></div><script src="/lib/highlight/highlight.pack.js?v=20171001"></script><script src=https://cdn.jsdelivr.net/npm/jquery@3.2.1/dist/jquery.min.js integrity="sha256-hwg4gsxgFZhOsEEamdOYGBf13FyQuiTwlAQgxVSNgt4=" crossorigin=anonymous></script><script src=https://cdn.jsdelivr.net/npm/slideout@1.0.1/dist/slideout.min.js integrity="sha256-t+zJ/g8/KXIJMjSVQdnibt4dlaDxc9zXr/9oNPeWqdg=" crossorigin=anonymous></script><script src=https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@3.1.20/dist/jquery.fancybox.min.js integrity="sha256-XVLffZaxoWfGUEbdzuLi7pwaUJv1cecsQJQqGLe7axY=" crossorigin=anonymous></script><script type=text/javascript src=/js/main.min.c12618f9a600c40bd024996677e951e64d3487006775aeb22e200c990006c5c7.js></script><script async src="https://www.googletagmanager.com/gtag/js?id=G-SYKLLYTW9K"></script><script>window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments);}
gtag('js',new Date());gtag('config','G-SYKLLYTW9K');</script></body></html>